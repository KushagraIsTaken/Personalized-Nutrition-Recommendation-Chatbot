<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <title>Healthcare Chatbot</title>
</head>
<body>
    <div class="chat-container">
        <h1>Healthcare Chatbot</h1>
        
        <div id="state-selection" class="state-selection">
            <label for="state">Select your state:</label>
            <select id="state" required>
                <option value="" disabled selected>Select your state</option>
                <option value="Alabama">Alabama</option>
                <option value="Alaska">Alaska</option>
                <option value="Arizona">Arizona</option>
                <option value="Arkansas">Arkansas</option>
                <option value="California">California</option>
                <option value="Colorado">Colorado</option>
                <option value="Connecticut">Connecticut</option>
                <option value="Delaware">Delaware</option>
                <option value="District of Columbia">District of Columbia</option>
                <option value="Florida">Florida</option>
                <option value="Georgia">Georgia</option>
                <option value="Hawaii">Hawaii</option>
                <option value="Idaho">Idaho</option>
                <option value="Illinois">Illinois</option>
                <option value="Indiana">Indiana</option>
                <option value="Iowa">Iowa</option>
                <option value="Kansas">Kansas</option>
                <option value="Kentucky">Kentucky</option>
                <option value="Louisiana">Louisiana</option>
                <option value="Maine">Maine</option>
                <option value="Maryland">Maryland</option>
                <option value="Massachusetts">Massachusetts</option>
                <option value="Michigan">Michigan</option>
                <option value="Minnesota">Minnesota</option>
                <option value="Mississippi">Mississippi</option>
                <option value="Missouri">Missouri</option>
                <option value="Montana">Montana</option>
                <option value="Nebraska">Nebraska</option>
                <option value="Nevada">Nevada</option>
                <option value="New Hampshire">New Hampshire</option>
                <option value="New Jersey">New Jersey</option>
                <option value="New Mexico">New Mexico</option>
                <option value="New York">New York</option>
                <option value="North Carolina">North Carolina</option>
                <option value="North Dakota">North Dakota</option>
                <option value="Ohio">Ohio</option>
                <option value="Oklahoma">Oklahoma</option>
                <option value="Oregon">Oregon</option>
                <option value="Pennsylvania">Pennsylvania</option>
                <option value="Rhode Island">Rhode Island</option>
                <option value="South Carolina">South Carolina</option>
                <option value="South Dakota">South Dakota</option>
                <option value="Tennessee">Tennessee</option>
                <option value="Texas">Texas</option>
                <option value="Utah">Utah</option>
                <option value="Vermont">Vermont</option>
                <option value="Virginia">Virginia</option>
                <option value="Washington">Washington</option>
                <option value="West Virginia">West Virginia</option>
                <option value="Wisconsin">Wisconsin</option>
                <option value="Wyoming">Wyoming</option>
            </select>
            <button id="select-state-button">Proceed</button>
        </div>

        <div id="chat-box" class="chat-box" style="display: none;"></div>
        <div class="input-container" style="display: none;">
            <input type="text" id="user-input" placeholder="Type your message here..." />
            <button id="send-button">Send</button>
        </div>
    </div>

    <script>
        let selectedState = ""; 

        document.getElementById('select-state-button').onclick = function() {
            selectedState = document.getElementById('state').value;
            if (selectedState) {
                document.getElementById('state-selection ').style.display = 'none';
                document.getElementById('chat-box').style.display = 'block';
                document.querySelector('.input-container').style.display = 'block';
            } 
            else {
                alert("Please select a state.");
            }
        };

        document.getElementById('send-button').onclick = function() {
            const userInput = document.getElementById('usr-input').value;
            if (userInput) {
                appendMessage('You', userInput);
                document.getElementById('user-input').value = '';

                fetch('/send', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ message: userInput, state: selectedState }) 
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    appendMessage('Chatbot', data.response);
                })
                .catch(error => {
                    console.error('There was a problem with the fetch operation:', error);
                });
            }
        };

        function appendMessage(sender, message) {
            const chatBox = document.getElementById('chat-box');
            const messageElement = document.createElement('div');
            messageElement.className = sender === 'You' ? 'user-message' : 'chatbot-message';
            messageElement.textContent = `${sender}: ${message}`;
            chatBox.appendChild(messageElement);
            chatBox.scrollTop = chatBox.scrollHeight; 
        }
    </script>
</body>
</html>